<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã™ãšãIIIã‚¯ã‚¤ã‚ºï½œPLAY MODE</title>
  <!--
    âœ… å­¦ç¿’ãƒ¡ãƒ¢ï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ç›®çš„ï¼‰
    - è‡ªå·±ç´¹ä»‹ãƒšãƒ¼ã‚¸(index.html)ã¯ã‚·ãƒƒã‚¯ã€‚ã“ã¡ã‚‰ã¯ã€ŒéŠã³å¿ƒã®ã‚ã‚‹ã‚²ãƒ¼ãƒ é¢¨ã€ãƒ‡ã‚¶ã‚¤ãƒ³ã€‚
    - 1ãƒ•ã‚¡ã‚¤ãƒ«å®Œçµï¼ˆç”»åƒãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã—ï¼‰ã§å‹•ãã€‚ã‚³ãƒ”ãƒšã§ä½¿ãˆã‚‹ã€‚
    - åˆå¿ƒè€…ã«ã‚‚èª­ã¿ã‚„ã™ã„ã‚ˆã†ã«ã€è¦æ‰€ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥ã‚Œã¦ã‚ã‚Šã¾ã™ã€‚
  -->
  <style>
    /* ============ 1) ãƒ™ãƒ¼ã‚¹ã¨èƒŒæ™¯ï¼ˆéŠã³å¿ƒã®ç¬¬ä¸€æ­©ã¯â€œå‹•ãèƒŒæ™¯â€ï¼‰ ============ */
    :root{
      --ink:#e5e7eb;        /* æ–‡å­—è‰²(è–„ã„ç™½) */
      --muted:#94a3b8;      /* ã‚µãƒ–æ–‡å­— */
      --card:#0b1220cc;     /* ã‚«ãƒ¼ãƒ‰(åŠé€æ˜) */
      --edge:#1f2937;       /* æ ç·š */
      --accent:#22d3ee;     /* ã‚¢ãƒ³ã‚µãƒ¼é¸æŠæ™‚ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ(ã‚·ã‚¢ãƒ³) */
      --brand:#a78bfa;      /* ãƒ–ãƒ©ãƒ³ãƒ‰è‰²(ãƒ‘ãƒ¼ãƒ—ãƒ«) */
      --ok:#22c55e;         /* æ­£è§£è‰²(ã‚°ãƒªãƒ¼ãƒ³) */
      --ng:#ef4444;         /* ä¸æ­£è§£è‰²(ãƒ¬ãƒƒãƒ‰) */
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif;
      color:var(--ink); overflow:hidden; /* èƒŒæ™¯ã‚¢ãƒ‹ãƒ¡ã‚’æ´»ã‹ã™ãŸã‚ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç„¡ã—ã« */
      background: radial-gradient(1200px 600px at 50% -200px, #111827 0%, #020617 60%);
    }
    /* èƒŒæ™¯ã®â€œã‚†ã‚‰ãã‚°ãƒ©ãƒ‡â€ç”¨ã®å††å½¢ãƒ–ãƒ­ãƒ–ï¼ˆæ“¬ä¼¼è¦ç´ ã§2æšï¼‰ */
    .bg{
      position:fixed; inset:-20vmax; pointer-events:none; filter:blur(40px) saturate(160%);
    }
    .bg::before, .bg::after{
      content:""; position:absolute; width:60vmax; height:60vmax; border-radius:50%;
      background: radial-gradient(circle, rgba(34,211,238,.8), transparent 60%);
      animation: float1 18s ease-in-out infinite;
    }
    .bg::after{
      left:40%; top:20%; width:50vmax; height:50vmax;
      background: radial-gradient(circle, rgba(167,139,250,.8), transparent 60%);
      animation: float2 22s ease-in-out infinite;
    }
    @keyframes float1{ 0%,100%{transform:translate(-10%, -5%)} 50%{transform:translate(10%, 10%)} }
    @keyframes float2{ 0%,100%{transform:translate(5%, -8%)} 50%{transform:translate(-8%, 6%)} }

    /* ============ 2) ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆä¸­å¤®ã«ã‚²ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ï¼‰ ============ */
    .wrap{position:relative; height:100%; display:grid; place-items:center; padding:20px;}
    .card{
      width:min(720px, 96vw); min-height:480px; background:var(--card); border:1px solid var(--edge);
      border-radius:24px; box-shadow:0 20px 60px rgba(0,0,0,.55); backdrop-filter: blur(10px);
      display:flex; flex-direction:column; padding:20px; overflow:hidden;
    }
    header{display:flex; align-items:center; justify-content:space-between; gap:12px;}
    .title{font-weight:900; letter-spacing:.04em;}
    .badge{font-size:12px; color:var(--muted); border:1px solid var(--edge); padding:6px 10px; border-radius:999px;}

    /* é€²æ—ãƒãƒ¼ */
    .progress{height:10px; background:#0b1220; border:1px solid var(--edge); border-radius:999px; overflow:hidden;}
    .bar{height:100%; width:0%; background:linear-gradient(90deg, var(--brand), var(--accent)); transition:width .35s ease;}

    /* è³ªå•ã¨å›ç­” */
    .stage{flex:1; display:grid; grid-template-rows:auto 1fr auto; gap:16px;}
    .question{font-size:clamp(18px,2.6vw,24px); font-weight:900;}
    .answers{display:grid; gap:12px; align-content:start;}
    .ans{position:relative; text-align:left; padding:14px 16px; border-radius:14px; border:1px solid var(--edge);
      background:#0b1220; color:var(--ink); cursor:pointer; font-weight:700;}
    .ans:hover{outline:2px solid var(--accent)}
    .ans.correct{border-color:var(--ok); box-shadow:0 0 0 2px rgba(34,197,94,.2) inset}
    .ans.wrong{border-color:var(--ng); box-shadow:0 0 0 2px rgba(239,68,68,.2) inset}

    .controls{display:flex; gap:10px; justify-content:flex-end}
    .btn{cursor:pointer; border:none; padding:12px 16px; border-radius:12px; font-weight:900;}
    .btn-ghost{background:#0b1220; color:var(--ink); border:1px solid var(--edge)}
    .btn-primary{background:linear-gradient(90deg, var(--brand), var(--accent)); color:#001018}

    /* çµæœç”»é¢ */
    .center{height:100%; display:grid; place-items:center}
    .result{
      text-align:center; padding:24px; border:1px solid var(--edge); background:#0b1220; border-radius:20px;
      max-width:520px;
    }
    .score{font-size:42px; font-weight:900; letter-spacing:.02em;}
    .muted{color:var(--muted); font-size:13px}

    /* ä¸‹éƒ¨ãƒŠãƒ“ï¼ˆãƒ›ãƒ¼ãƒ ãƒªãƒ³ã‚¯ï¼‰ */
    .foot{
      display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:10px;
      color:var(--muted); font-size:12px;
    }
    .link{color:var(--ink); text-decoration:none; border-bottom:1px dashed var(--accent)}

    /* å°ã•ã‚ç”»é¢ã®æœ€é©åŒ– */
    @media (max-width:540px){
      .answers{grid-template-columns:1fr}
    }
    @media (min-width:541px){
      .answers{grid-template-columns:1fr 1fr}
    }
  </style>
</head>
<body>
  <!-- ã‚†ã‚‰ãèƒŒæ™¯ãƒ–ãƒ­ãƒ– -->
  <div class="bg"></div>

  <div class="wrap">
    <div class="card" role="region" aria-label="ã‚¯ã‚¤ã‚ºã‚«ãƒ¼ãƒ‰">
      <header>
        <div class="title">PLAY MODE</div>
        <div class="badge">è‡ªå·±ç´¹ä»‹ãƒ™ãƒ¼ã‚¹ã®4æŠã‚¯ã‚¤ã‚º</div>
      </header>

      <div style="margin:10px 0 6px">é€²æ—</div>
      <div class="progress" aria-label="é€²æ—ãƒãƒ¼"><div class="bar" id="bar"></div></div>

      <!-- ===== ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆè³ªå• / å›ç­” / ãƒœã‚¿ãƒ³ï¼‰ ===== -->
      <section id="stage" class="stage" aria-live="polite">
        <div class="question" id="q"></div>
        <div class="answers" id="answers"></div>
        <div class="controls">
          <button class="btn btn-ghost" id="prev">æˆ»ã‚‹</button>
          <button class="btn btn-primary" id="next">æ¬¡ã¸</button>
        </div>
      </section>

      <!-- ===== çµæœãƒ“ãƒ¥ãƒ¼ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ ===== -->
      <section id="resultView" class="center" style="display:none">
        <div class="result">
          <div class="muted" style="margin-bottom:6px">çµæœ</div>
          <div class="score" id="score"></div>
          <p class="muted" id="comment" style="margin:6px 0 14px"></p>
          <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
            <button class="btn btn-primary" id="retry">ã‚‚ã†ä¸€åº¦</button>
            <a class="btn btn-ghost" href="index.html">è‡ªå·±ç´¹ä»‹ã¸æˆ»ã‚‹</a>
          </div>
        </div>
      </section>

      <!-- ãƒ•ãƒƒã‚¿ãƒ¼çš„ãƒŠãƒ“æƒ…å ± -->
      <div class="foot">
        <span>çŸ¢å°ã‚­ãƒ¼ã§ã‚‚æ“ä½œã§ãã¾ã™ â† / â†’</span>
        <a class="link" href="index.html">index.htmlï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼‰</a>
      </div>
    </div>

    <!-- ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ç”¨ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼ˆæ­£è§£/çµæœã§èŠ±å¹é›ªï¼‰ -->
    <canvas id="fx" width="0" height="0" style="position:fixed; inset:0; pointer-events:none;"></canvas>
  </div>

<script>
  // ========== 0) è‡ªå·±ç´¹ä»‹ãƒ‡ãƒ¼ã‚¿ï¼ˆindex.htmlã¨åˆã‚ã›ã‚‹ï¼‰ ==========
  const profile = {
    name: "ã™ãšãIII",
    from: "åŒ—æµ·é“",
    food: "ãƒ©ãƒ¼ãƒ¡ãƒ³",
    hobbies: "ã‚­ãƒ£ãƒ³ãƒ—ã€ã‚´ãƒ«ãƒ•",
    family: "å¦»ã€4æ­³æ¯å­",
  };

  // ========== 1) å•é¡Œã‚»ãƒƒãƒˆï¼ˆéŠã³å¿ƒï¼šæ¯å›ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼‰ ==========
  function makeQuestions(p){
    const qs = [];
    qs.push({ q: "å‡ºèº«åœ°ã¯ã©ã“ï¼Ÿ", a: p.from, c: [p.from, "æ±äº¬", "æ²–ç¸„", "å¤§é˜ª"] });
    qs.push({ q: "å¥½ããªé£Ÿã¹ç‰©ã¯ï¼Ÿ", a: p.food, c: [p.food, "å¯¿å¸", "ã‚«ãƒ¬ãƒ¼", "ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼"] });
    qs.push({ q: "è¶£å‘³ã¯ã©ã‚Œï¼Ÿ", a: p.hobbies, c: [p.hobbies, "èª­æ›¸ã€å°†æ£‹", "æ˜ ç”»é‘‘è³ã€éŸ³æ¥½", "ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã€æ–™ç†"] });
    qs.push({ q: "å®¶æ—æ§‹æˆã¯ï¼Ÿ", a: p.family, c: [p.family, "ç‹¬èº«", "å¦»ã€2æ­³å¨˜", "å¤«ã€çŒ«2åŒ¹"] });
    qs.push({ q: "ç§ã®åå‰ã¯ï¼Ÿ", a: p.name, c: [p.name, "éˆ´æœ¨ä¸€éƒ", "ç”°ä¸­å¤ªéƒ", "ã™ãšãJr."] });
    return shuffle(qs).map(it=> ({...it, c: shuffle(it.c)}));
  }
  const questions = makeQuestions(profile);

  // ========== 2) UIã¨çŠ¶æ…‹ ==========
  const dom = {
    q: document.getElementById('q'),
    answers: document.getElementById('answers'),
    bar: document.getElementById('bar'),
    stage: document.getElementById('stage'),
    result: document.getElementById('resultView'),
    score: document.getElementById('score'),
    comment: document.getElementById('comment'),
    prev: document.getElementById('prev'),
    next: document.getElementById('next'),
    retry: document.getElementById('retry'),
  };

  let step = 0;                 // ä½•å•ç›®ã‹
  const selected = new Map();   // step -> choice text

  function render(){
    const total = questions.length;
    if (step>=total) return showResult();

    const { q, c, a } = questions[step];
    dom.q.textContent = `Q${step+1}. ${q}`;
    dom.answers.innerHTML = '';
    c.forEach(choice => {
      const b = document.createElement('button');
      b.className = 'ans'; b.textContent = choice;
      b.addEventListener('click', () => {
        selected.set(step, choice);
        // ã‚¯ãƒªãƒƒã‚¯æ™‚ã®è¦‹ãŸç›®ï¼ˆæ­£èª¤ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰
        [...dom.answers.children].forEach(el => el.classList.remove('correct','wrong'));
        b.classList.add(choice === a ? 'correct' : 'wrong');
        if(choice === a) burstConfetti();
      });
      dom.answers.appendChild(b);
    });
    dom.bar.style.width = `${(step)/total*100}%`;
    dom.prev.disabled = (step===0);
  }

  function showResult(){
    const total = questions.length; let ok = 0;
    questions.forEach((q, i) => { if (selected.get(i) === q.a) ok++; });
    dom.stage.style.display = 'none'; dom.result.style.display = 'grid';
    dom.bar.style.width = '100%';
    dom.score.textContent = `${ok} / ${total}`;
    dom.comment.textContent = ok===total ? 'ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼ã‚»ãƒ³ã‚¹æŠœç¾¤âœ¨' : (ok>=Math.ceil(total*0.6) ? 'ã„ã„æ„Ÿã˜ï¼ã‚‚ã†ä¸€æ­©ã§æº€ç‚¹ğŸ‘' : 'ãƒŠã‚¤ã‚¹ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ã‚‚ã†ä¸€å›ã„ã“ã†ğŸ’ª');
    bigConfetti();
  }

  dom.next.addEventListener('click', () => { if(step<questions.length){ step++; render(); } if(step===questions.length) showResult(); });
  dom.prev.addEventListener('click', () => { if(step>0){ step--; render(); } });
  dom.retry && dom.retry.addEventListener('click', () => { step=0; selected.clear();
    // æ–°ã—ã„ä¸¦ã³ã§å†ç”Ÿæˆã—ã¦é£½ããªã„ã‚ˆã†ã«
    const fresh = makeQuestions(profile); questions.splice(0, questions.length, ...fresh);
    dom.result.style.display = 'none'; dom.stage.style.display = 'grid'; render(); });

  // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œï¼ˆâ† â†’ï¼‰
  window.addEventListener('keydown', (e)=>{
    if(e.key==='ArrowRight') dom.next.click();
    if(e.key==='ArrowLeft') dom.prev.click();
  });

  // åˆæœŸæç”»
  render();

  // ========== 3) å°ã•ãªæ¼”å‡ºï¼šèŠ±å¹é›ªã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆCanvasï¼‰ ==========
  const fx = document.getElementById('fx');
  const ctx = fx.getContext('2d');
  let W=0,H=0; const pieces=[]; let tick=0; const colors=['#22d3ee','#a78bfa','#22c55e','#facc15','#f472b6'];
  function resize(){ W = fx.width = innerWidth; H = fx.height = innerHeight; }
  addEventListener('resize', resize); resize();

  function addPieces(n, big=false){
    for(let i=0;i<n;i++){
      pieces.push({
        x: Math.random()*W,
        y: big? H*0.3 : H*0.4,
        vx: (Math.random()-.5)*3,
        vy: -Math.random()* (big? 10:6) - (big? 8:4),
        r: Math.random()* (big? 10:5) + (big? 6:3),
        rot: Math.random()*Math.PI,
        vr: (Math.random()-.5)*0.2,
        color: colors[(Math.random()*colors.length)|0],
        g: 0.25
      });
    }
  }
  function burstConfetti(){ addPieces(20,false); }
  function bigConfetti(){ addPieces(180,true); }

  (function loop(){ requestAnimationFrame(loop); ctx.clearRect(0,0,W,H); tick++;
    for(let i=pieces.length-1;i>=0;i--){ const p=pieces[i];
      p.vy += p.g; p.x += p.vx; p.y += p.vy; p.rot += p.vr;
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
      ctx.fillStyle=p.color; ctx.beginPath(); ctx.moveTo(-p.r,0); ctx.lineTo(0,-p.r*0.6); ctx.lineTo(p.r,0); ctx.lineTo(0,p.r*0.6); ctx.closePath(); ctx.fill(); ctx.restore();
      if(p.y>H+50||p.x<-50||p.x>W+50) pieces.splice(i,1);
    }
  })();

  // ========== 4) ä¾¿åˆ©é–¢æ•° ==========
  function shuffle(arr){ return [...arr].sort(()=>Math.random()-.5); }
</script>
</body>
</html>
